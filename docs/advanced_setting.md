# Расширенная настройка бота
### Словарь (автоответчик)
Используйте метод `bot.dict.import(obj)`, вместо **obj** используя объект в формате *запрос: ответ*

Пример:
```JavaScript
bot.dict.import({
    'Один': 'One',
    'Два': 'Two'
});
```
### Команды
Используйте метод `bot.msgevent.on(command, callback)`, вместо **command** используя строку, обозначающую команду без аргументов

Пример:
```JavaScript
bot.msgevent.on('2+2', function(peer){
    bot.sendmsg(peer.type, peer.id, '2+2=5')
});
```

С версии 2.1.0 вы можете получать все сообщения используя событие `newmsg`:
```JavaScript
bot.msgevent.on('newmsg', function(peer){
    // Обработка полученного сообщения, независимо от обращения
});
```
Также вы можете получать все сообщения используя `amsgevent`:
```JavaScript
const bot = require('./bot');
bot.init(false, 'access_token', 'rucaptcha_key');

bot.amsgevent.on('Привет!', function(peer){
    // Обработка полученного сообщения, независимо от обращения
    console.log(peer.msg.full)
    // Выведет "Привет!"
});
```

#### Строение объекта peer
```JavaScript
Для сообщений из беседы:
{
  type: 'conv', //Показывает, что сообщение из беседы, строка
  name: 'sBot Test', //Название беседы, строка
  id: 681, //ID беседы, число
  msgid: 2262051, //ID сообщения, число
  msg: {
    full: 'Test', //Полный текст сообщения, строка
    args: ['Test'] //Аргументы команды (если есть), массив
  },
  s: {
    id: 193158046, //ID отправителя, число
    fname: 'Евгений', //Имя отправителя, строка
    lname: 'Малевич' //Фамилия отправителя, строка
  }
}

Для личных сообщений:
{
  type: 'user', //Показывает, что сообщение от пользователя, строка
  id: 193158046, //ID отправителя, число
  msgid: 2262101, //ID сообщения, число
  msg: {
    full: 'Test', //Полный текст сообщения, строка
    args: ['Test'] //Аргументы команды (если есть), массив
  },
  s: {
    fname: 'Евгений', //Имя отправителя, строка
    lname: 'Малевич' //Фамилия отправителя, строка
  }
}
```
### Использование методов VK API
Используйте метод `bot.VK.call(method, args)`, где **method** - необходимый вам метод(строка), а **args** - аргументы метода(объект)
```JavaScript
bot.VK.call('users.get', {user_ids: 1})
  .then(res => console.log(res));

// Выведет:
// [ { id: 1, first_name: 'Павел', last_name: 'Дуров' } ]
```

### Ответ с помощью peer.answer()
#### Синтаксис метода


```JavaScript
peer.answer(text[, attachment][, stickerid])
```  

- **text** - Отправляемый текст сообщения, строка
- **attachment** - Медиафайл для прикрепления (аудио, видео, документ), строка
- **stickerid** - ID стикера, который надо прикрепить, число


### Синтаксис метода bot.sendmsg()
```JavaScript
bot.sendmsg(type, id, text[, attachment][, stickerid][, callback])
```
- **type** - Тип сообщения (личное, беседа), строка
- **id** - ID, куда нужно отправить сообщение (id пользователя или беседы), число
- **text** - Отправляемый текст сообщения, строка
- **attachment** - Медиафайл для прикрепления (аудио, видео, документ), строка
- **stickerid** - ID стикера, который надо прикрепить, число
- **callback** - Функция, выполняемая после отправки

#### Загрузка медиафайлов
```JavaScript
bot.VK.upload('photo', {data: d}, function(r){
  console.log(r) // photo12345_67890
})
```

- **type** - Типа медиафайла, список приведён ниже
- **data** - Сам медиафайл (Buffer)

#### Обработка LongPoll событий
```JavaScript
// Пример обработки события
bot.lpevent.on('eventname', function(args){
  // etc
})
```

**Список всех событий и возвращаемых объектов**
- *chat_create*: Создание чата(беседы)   
```JavaScript
{
  name: 'Новая беседа', // Название созданной беседы
  admin: { // Информация о создателе беседы
    id: 1,
    fname: 'Павел',
    lname: 'Дуров'
  },
  peer_id: 123 // ID созданной беседы
}
```
- *chat_title_update*: Обновление названия беседы   
```JavaScript
{
  oldname: 'Новая беседа', // Старое название беседы
  newname: 'Не такая уж и новая беседа', // Новое название беседы
  user: { // Информация о пользователе, который изменил название
    id: 1,
    fname: 'Павел',
    lname: 'Дуров'
  },
  peer_id: 123 // ID беседы, в которой было изменено название
}
```
- *chat_photo_update*: Обновление обложки беседы   
```JavaScript
{
  photo: 'photo1_1234567', // ID новой обложки беседы
  user: { // Информация о пользователе, который изменил обложку
    id: 1,
    fname: 'Павел',
    lname: 'Дуров'
  },
  peer_id: 123 // ID беседы, в которой была изменена обложка
}
```
- *chat_invite_user*: Приглашение участника в беседу (или возвращение в неё)   
```JavaScript
{
  inviter: { // Информация о пользователе, который пригласил участника
    id: 1,
    fname: 'Павел',
    lname: 'Дуров'
  }
  invited: { //  Информация о приглашённом участнике
    id: 6,
    fname: 'Николай',
    lname: 'Дуров'
  },
  peer_id: 123 // ID беседы, в которую пригласили участника
}
```
- *chat_kick_user*: Исключение участника из беседы (или выход из неё)   
```JavaScript
{
  kicker: { // Информация о пользователе, который исключил участника
    id: 1,
    fname: 'Павел',
    lname: 'Дуров'
  }
  kicked: { //  Информация об исключённом участнике
    id: 6,
    fname: 'Николай',
    lname: 'Дуров'
  },
  peer_id: 123 // ID беседы, в которой исключили участника
}
```


### Остальные методы и их синтаксис
1. `bot.getArgs(peer)` - Возвращает массив, содержащий аргументы (слова после команды), например `sBot, привет как дела? -> ['как', 'дела?']`
_Устарело. Вместо этого используйте массив peer.msg.args_
2. `bot.getAnswer(peer)` - Возвращает строку, содержащую обращение к пользователю, например `[id193158046|Евгений],` (ТОЛЬКО ДЛЯ БЕСЕД)
3. `bot.authid()` - Возвращает ID аккаунта, на котором работает sBot
3. `bot.botname()` - Возвращает массив с обращениями к боту, указанных при выполнении `bot.init()`
5. Поле `bot.version.codenum` - Возвращает версию sBot (номер + кодовое имя)
6. Поле `bot.version.num` - Возвращает версию sBot (только номер)

### Список типов медиафайлов
- `audio_msg` - Голосовое сообщение (документ)
- `graffiti` - Граффити (документ)
- `photo` - Фото для отправки в сообщения
